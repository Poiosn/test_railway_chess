<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chess Master ‚Äî Premium Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Inter', 'Segoe UI', 'Helvetica Neue', sans-serif;
      background: #87CEEB; /* Sky Blue */
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    /* GLASSMORPHISM CONTAINER */
    .container {
      background: rgba(255, 255, 255, 0.35); /* Slightly more opaque for readability */
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 
        0 8px 32px 0 rgba(31, 38, 135, 0.2),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.5);
      
      /* RESPONSIVE DIMENSIONS */
      width: 95%;
      max-width: 800px; /* Constrain width on desktop */
      padding: 30px;
      border-radius: 24px;
      
      /* FLUID HEIGHT (Fixes cropping) */
      height: auto;
      max-height: 90vh; /* On desktop, limit height */
      overflow-y: auto; /* Scroll if needed on desktop */
      
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: containerFadeIn 0.6s ease;
    }

    @keyframes containerFadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* TITLE STYLES */
    h1 {
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: clamp(28px, 5vw, 42px); /* Responsive Font Size */
      font-weight: 900;
      margin-bottom: 8px;
      letter-spacing: -1px;
      text-shadow: 0 0 30px rgba(102, 126, 234, 0.2);
    }

    .subtitle {
      text-align: center;
      color: #444;
      margin-bottom: 24px;
      font-size: 14px;
      font-weight: 600;
    }

    /* CONNECTION STATUS */
    .connection-status {
      width: 100%;
      text-align: center;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      color: white;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* GAME INFO CARD */
    .game-info {
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }
    .game-info h3 { margin-bottom: 5px; color: #333; }
    .game-info p { font-size: 14px; color: #555; }

    /* TIME CONTROL SECTION */
    .time-control-section {
      width: 100%;
      text-align: center;
      margin-bottom: 24px;
      padding: 20px;
      background: rgba(224, 247, 250, 0.5);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }
    .time-control-section h4 {
      color: #00695c;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .time-options {
      display: flex;
      flex-wrap: wrap; /* Allows wrapping */
      gap: 10px;
      justify-content: center;
    }

    .time-btn {
      flex: 1 1 80px; /* Grow, shrink, min-width */
      padding: 12px 10px;
      background: white;
      border: 2px solid #00897b;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      color: #00695c;
      transition: all 0.2s ease;
      text-align: center;
      white-space: nowrap;
    }
    .time-btn:hover { background: #00897b; color: white; transform: translateY(-2px); }
    .time-btn.selected { background: #00695c; color: white; border-color: #004d40; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

    /* CONTROLS (Inputs & Buttons) */
    .room-controls {
      width: 100%;
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    input[type="text"] {
      flex: 2;
      min-width: 200px;
      padding: 14px;
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 12px;
      font-size: 16px;
      outline: none;
      background: rgba(255,255,255,0.9);
      user-select: text;
      -webkit-user-select: text;
    }
    input[type="text"]:focus { border-color: #667eea; background: #fff; }

    button {
      flex: 1;
      min-width: 140px;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
      transition: transform 0.2s;
    }
    button:hover { transform: translateY(-2px); }
    button:active { transform: translateY(0); }

    .btn-bot {
      width: 100%;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      margin-top: 10px;
    }

    /* VISITOR COUNTER */
    #visitorCounter {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(102, 126, 234, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      backdrop-filter: blur(5px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 100;
    }

    /* MODAL */
    .name-modal {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      padding: 20px; /* Padding to prevent modal hitting screen edges */
    }
    .name-modal.active { display: flex; }

    .name-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .btn-secondary { background: #7f8c8d; }

    /* =========================================
       MOBILE & RESPONSIVE FIXES 
       ========================================= */
    
    /* TABLET & SMALLER DESKTOP (Width < 900px) */
    @media (max-width: 900px) {
      .container {
        width: 90%;
        max-height: 95vh;
      }
      .room-controls {
        flex-direction: column; /* Stack input and buttons */
      }
      input[type="text"], button {
        width: 100%;
        min-width: 0;
      }
    }

    /* MOBILE PHONES (Width < 600px) */
    @media (max-width: 600px) {
      body {
        padding: 0;
        align-items: center; /* Center vertically */
        background: #f0f8ff; /* Fallback flat color for performance */
        height: 100vh;
        overflow: hidden;
      }

      .container {
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0; /* Remove corners */
        border: none;
        background: rgba(255, 255, 255, 0.85); /* More opaque */
        padding: 10px 16px;
        padding-bottom: 40px;
        justify-content: center; /* Center content */
        padding-top: 10px;
        overflow-y: auto;
        margin-bottom: 0;
      }

      h1 { font-size: 26px; margin-top: 0; margin-bottom: 4px; }
      
      .subtitle { margin-bottom: 10px; font-size: 12px; }
      
      .time-btn {
        flex: 1 1 30%; /* 3 buttons per row */
        font-size: 12px;
        padding: 8px;
      }
      
      .game-info, .time-control-section {
        padding: 10px;
        margin-bottom: 10px;
      }

      .game-info h3 { font-size: 14px; margin-bottom: 2px; }
      .game-info p { font-size: 12px; margin: 0; }
      .time-control-section h4 { margin-bottom: 6px; font-size: 14px; }
      
      .connection-status {
        margin-bottom: 10px;
        padding: 8px;
        font-size: 12px;
      }

      .room-controls { margin-bottom: 10px; gap: 8px; }
      input[type="text"] { padding: 10px; }
      button { padding: 10px; }
      
      .btn-bot {
        margin-bottom: 10px;
        margin-top: 0;
      }
      
      #visitorCounter {
        bottom: 5px;
        right: 5px;
        font-size: 10px;
        padding: 4px 10px;
        position: fixed;
      }
    }
  </style>
</head>
<body>

<div class="container">

    <h1>‚ôî Chess Master ‚ôö</h1>
    <p class="subtitle">‚ö° Premium Edition ‚Äî Real-time Multiplayer</p>

    <div id="connectionStatus" class="connection-status">‚úÖ Welcome to Chess Master</div>

    <div class="game-info">
      <h3>üéÆ Game Lobby</h3>
      <p>Create a room, join a friend, or practice against our bot.</p>
    </div>

    <div class="time-control-section">
      <h4>‚è±Ô∏è Select Time Control</h4>
      <div class="time-options">
        <div class="time-btn" onclick="selectTime(60)" data-time="60">‚ö° 1 min</div>
        <div class="time-btn" onclick="selectTime(180)" data-time="180">üî• 3 min</div>
        <div class="time-btn selected" onclick="selectTime(300)" data-time="300">‚ôüÔ∏è 5 min</div>
        <div class="time-btn" onclick="selectTime(600)" data-time="600">üéØ 10 min</div>
        <div class="time-btn" onclick="selectTime(900)" data-time="900">üëë 15 min</div>
      </div>
    </div>

    <div class="room-controls">
      <input type="text" id="roomInput" placeholder="Enter room name (e.g. room1)">
      <button onclick="createRoom()">üö™ Create Room</button>
      <button onclick="joinRoom()">‚û°Ô∏è Join Room</button>
    </div>

    <button onclick="playBot()" class="btn-bot">ü§ñ Play vs Stockfish Bot</button>

</div>

<div class="name-modal" id="nameModal" aria-hidden="true">
  <div class="name-content">
    <h3>üë§ Enter Your Name</h3>
    <p id="namePromptText" style="color:#666;margin-top:8px;">What should we call you?</p>
    <input 
      type="text" 
      id="playerNameInput" 
      placeholder="e.g., Magnus, Hikaru..." 
      maxlength="20"
      style="margin-top:16px; width:100%; box-sizing:border-box;"
    />
    <div style="margin-top:20px; display:flex; gap:12px; justify-content:center;">
      <button onclick="submitPlayerName()" style="background:#11998e;">‚úÖ Go</button>
      <button onclick="cancelNameModal()" class="btn-secondary">‚ùå Cancel</button>
    </div>
  </div>
</div>

<div id="visitorCounter">
    <span>üë• Total Visits: <span id="visitorCountValue">...</span></span>
</div>

<script>
let pendingRoomAction = null;

function selectTime(sec){
  document.querySelectorAll(".time-btn").forEach(b=>{
    b.classList.toggle("selected", parseInt(b.dataset.time) === sec);
  });
}

function createRoom(){
  const timeBtn = document.querySelector(".time-btn.selected");
  const timeControl = timeBtn ? parseInt(timeBtn.dataset.time) : 300;
  const roomInput = document.getElementById("roomInput");
  const room = roomInput ? (roomInput.value.trim() || ("room" + Math.random().toString(36).slice(2,6))) : "room" + Math.random().toString(36).slice(2,6);
  showNameModal("create", { room, timeControl });
}

function joinRoom(){
  const roomInput = document.getElementById("roomInput");
  const room = roomInput ? roomInput.value.trim() : "";
  if(!room) {
    alert("Please enter a room name to join!");
    return;
  }
  showNameModal("join", { room });
}

function playBot(){
  const timeBtn = document.querySelector(".time-btn.selected");
  const timeControl = timeBtn ? parseInt(timeBtn.dataset.time) : 300;
  const room="bot-"+Math.random().toString(36).slice(2,8);
  showNameModal("bot", { room, timeControl });
}

function showNameModal(actionType, actionData = {}) {
  const modal = document.getElementById("nameModal");
  const promptText = document.getElementById("namePromptText");
  const input = document.getElementById("playerNameInput");
  
  if (!modal || !input) return;

  input.value = "";
  if (actionType === "create") promptText.textContent = "Creating Room. Your name?";
  else if (actionType === "join") promptText.textContent = "Joining Room. Your name?";
  else if (actionType === "bot") promptText.textContent = "Playing vs Bot. Your name?";

  pendingRoomAction = { type: actionType, data: actionData };
  modal.classList.add("active");
  setTimeout(()=>input.focus(), 100);

  input.onkeydown = (e) => {
    if (e.key === "Enter") submitPlayerName();
  };
}

function submitPlayerName() {
  const input = document.getElementById("playerNameInput");
  const nameValue = input ? input.value.trim() : "";
  if (!nameValue) {
    alert("Please enter your name");
    return;
  }
  document.getElementById("nameModal").classList.remove("active");
  
  if (pendingRoomAction) {
    const { type, data } = pendingRoomAction;
    const params = new URLSearchParams({
        room: data.room,
        name: nameValue,
        mode: type,
        time: data.timeControl || 300
    });
    window.location.href = `/game?${params.toString()}`;
  }
}

function cancelNameModal() {
  document.getElementById("nameModal").classList.remove("active");
  pendingRoomAction = null;
}

(async function() {
    try {
        const response = await fetch('/api/visitor-count');
        const data = await response.json();
        const el = document.getElementById('visitorCountValue');
        if(el) el.textContent = data.visitor_count || '0';
    } catch (e) { console.error("Visitor count failed"); }
})();
</script>
</body>
</html
